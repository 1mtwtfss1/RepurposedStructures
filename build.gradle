buildscript {
    repositories {
        maven { url = 'https://maven.minecraftforge.net' }
        mavenCentral()
        maven { url = 'https://repo.spongepowered.org/repository/maven-public/' }
        maven { url "https://plugins.gradle.org/m2/" }
    }
    dependencies {
        classpath group: 'net.minecraftforge.gradle', name: 'ForgeGradle', version: '5.1.+', changing: true
        classpath 'org.spongepowered:mixingradle:0.7-SNAPSHOT'
        classpath "gradle.plugin.com.matthewprenger:CurseGradle:1.4.0"
        classpath group: 'gradle.plugin.com.modrinth.minotaur', name: 'Minotaur', version: '1.2.1'
    }
}

apply plugin: 'net.minecraftforge.gradle'
apply plugin: 'maven-publish'
apply plugin: 'org.spongepowered.mixin'

version = "${mod_version}+${mc_version}"
group = "com.telepathicgrunt"
archivesBaseName = "${modid}_forge"

java.toolchain.languageVersion = JavaLanguageVersion.of(17)

minecraft {
    mappings channel: "official", version: "${mc_version}"
    accessTransformer = file('src/main/resources/META-INF/accesstransformer.cfg')
   
    runs {
        client {
            workingDirectory project.file('run')
            arg "-mixin.config=" + project.getProperty('modid') + ".mixins.json"
            property 'mixin.env.remapRefMap', 'true'
            property 'mixin.env.refMapRemappingFile', "${projectDir}/build/createSrgToMcp/output.srg"
            mods { repurposed_structures { source sourceSets.main } }
        }

        server {
            workingDirectory project.file('run')
            arg "-mixin.config=" + project.getProperty('modid') + ".mixins.json"
            property 'mixin.env.remapRefMap', 'true'
            property 'mixin.env.refMapRemappingFile', "${projectDir}/build/createSrgToMcp/output.srg"
            mods { repurposed_structures { source sourceSets.main } }
        }

        data {
            workingDirectory project.file('run')
            args '--mod', project.getProperty('modid'), '--all', '--output', file('src/generated/resources/'), '--existing', file('src/main/resources/')
            arg "-mixin.config=" + project.getProperty('modid') + ".mixins.json"
            property 'mixin.env.remapRefMap', 'true'
            property 'mixin.env.refMapRemappingFile', "${projectDir}/build/createSrgToMcp/output.srg"
            mods { repurposed_structures { source sourceSets.main } }
        }
    }
}

repositories {
    maven { url "https://nexus.resourcefulbees.com/repository/maven-public/" }
    maven { url "https://www.cursemaven.com" }
}

dependencies {
    minecraft "net.minecraftforge:forge:${mc_version}-${forge_version}"
    annotationProcessor "org.spongepowered:mixin:0.8.5:processor"
    
    runtimeOnly fg.deobf("com.telepathicgrunt:CommandStructures:1.4.0+1.18.1")

    // 1.18.1
    //runtimeOnly fg.deobf("curse.maven:morevillagers-484954:3548004")
    //runtimeOnly fg.deobf("curse.maven:hexerei-548599:3562165")

    // 1.16.5
    //runtimeOnly fg.deobf("curse.maven:simply_cats-332910:3498688")
    //runtimeOnly fg.deobf("curse.maven:bountiful-309516:3239647")
    //runtimeOnly fg.deobf("curse.maven:kotlin_forge-351264:3452303")
    // runtimeOnly fg.deobf("curse.maven:caves_and_cliffs_backport-417430:3523829")
    // runtimeOnly fg.deobf("curse.maven:caves_api-441706:3512246")
    // runtimeOnly fg.deobf("curse.maven:better_dungeons-510089:3476138")
    // runtimeOnly fg.deobf("curse.maven:yungs_api-421850:3494919")
    // runtimeOnly fg.deobf("curse.maven:better_strongholds-465575:3412586")
    // runtimeOnly fg.deobf("curse.maven:relics-445274:3470411")
    // runtimeOnly fg.deobf("curse.maven:curios-309927:3456953")
    // runtimeOnly fg.deobf("curse.maven:vampirism-233029:3475085")
    // runtimeOnly fg.deobf("curse.maven:farmers_delight-398521:3418719")
    // runtimeOnly fg.deobf("curse.maven:tardus-290247:3482231")
    // runtimeOnly fg.deobf("curse.maven:etched-491890:3364913")
    // runtimeOnly fg.deobf("curse.maven:pneumaticcraftrepressurized-281849:3470048")
    // runtimeOnly fg.deobf("curse.maven:immersiveengineering-231951:3431122")
    // runtimeOnly fg.deobf("curse.maven:jellyfishing-397703:3458825")
    // runtimeOnly fg.deobf("curse.maven:buzzierbees-355458:3226433")
    // runtimeOnly fg.deobf("curse.maven:abnormalcore-382216:3457851")
    // runtimeOnly fg.deobf("curse.maven:environmental-388992:3416597")
    // runtimeOnly fg.deobf("curse.maven:ice_and_fire-264231:3441117")
    // runtimeOnly fg.deobf("curse.maven:rat-323596:3319810")
    // runtimeOnly fg.deobf("curse.maven:citadel-331936:3441028")
    // runtimeOnly fg.deobf("curse.maven:savageandravage-381736:3226442")
    // runtimeOnly fg.deobf("curse.maven:dungeonsgear-401247:3517064")
    // runtimeOnly fg.deobf("curse.maven:endremastered-404183:3406091")
    // runtimeOnly fg.deobf("vazkii.autoreglib:AutoRegLib:1.6-49.90")
    // runtimeOnly fg.deobf("vazkii.quark:Quark:r2.4-316.1925") { transitive = false }
    // runtimeOnly fg.deobf("curse.maven:hexlands_ii-522216:3444952")
    // runtimeOnly fg.deobf("com.resourcefulbees:ResourcefulBees:1.16.5-0.9.9.7")
    // runtimeOnly fg.deobf("curse.maven:tidbits-514057:3450123")
    // runtimeOnly fg.deobf("curse.maven:charmreforged-430988:3214651")
}


mixin {
    add sourceSets.main, "${modid}.refmap.json"
}

apply from: 'gradle/processresources.gradle'
apply from: 'gradle/manifest.gradle'
apply from: 'gradle/maven.gradle'
apply from: 'gradle/curseforge.gradle'
apply from: 'gradle/modrinth.gradle'

task buildAndRelease{}
tasks.publish.mustRunAfter tasks.build
tasks.curseforge.mustRunAfter tasks.publish
tasks.publishModrinth.mustRunAfter tasks.publish
tasks.buildAndRelease.dependsOn(tasks.build, tasks.publish, tasks.curseforge, tasks.publishModrinth)